plugins {
    id 'groovy'
}

repositories {
    mavenCentral()
    mavenLocal()
}

import org.gradle.internal.os.OperatingSystem
String resolveKatalonStudioInstallationDirectory() {
    OperatingSystem os = OperatingSystem.current();
    //println "*** Building on ${os.familyName} / ${os.name} / ${os.version} / ${System.getProperty("os.arch")}."
    println "*** Building on ${os.toString()}."
    if (os.isMacOsX()) {
        return '/Applications/Katalon Studio.app'
    } else if (os.isWindows()) {
        // Consider Windows.
        throw new UnsupportedOperationException("To be considered")
    } else if (os.isLinux()) {
        // Consider Linux.
        throw new UnsupportedOperationException("I don't know")
    } else {
        // Unknown OS.
        return new UnsupportedOperationException("Who knows?")
    }
}

ext {
    KATALON_STUDIO_INSTALLATION_DIRECTORY = resolveKatalonStudioInstallationDirectory()
}

dependencies {
    implementation fileTree(dir: "${KATALON_STUDIO_INSTALLATION_DIRECTORY}/Contents/Eclipse/configuration/resources/lib",
            include: [
                    'groovy-3.0.17.jar',
                    'selenium-server*.jar',
                    'slf4j*.jar'
            ]
    )

    implementation fileTree(dir: "${KATALON_STUDIO_INSTALLATION_DIRECTORY}/Contents/Eclipse/plugins",
            include: [
                    'com.fasterxml.jackson*.jar',
                    'com.google.gson*.jar',

                    // to import com.kms.katalon.core.testobject.TestObject
                    // to import com.kms.katalon.core.testobject.SelectorMethod
                    // to import com.kms.katalon.core.testobject.ObjectRepository
                    'com.kms.katalon.core*.jar',
                    'com.kms.katalon.util*.jar',

                    // to import groovy.lang.GroovyObject
                    '**/org.codehaus.groovy*/lib/groovy*-indy.jar',

                    'org.apache.commons.lang*.jar',
                    'org.dom4j*.jar',
                    'org.eclipse.osgi*.jar'
            ])

    // will be resolved via mavenLocal()
    implementation("com.kazurayam:MonkDirectoryScanner:0.1.0")
    testImplementation "junit:junit:4.13.2"
    testImplementation 'org.slf4j:slf4j-simple:1.7.25'
}

tasks.register('printClasspath') {
    doFirst {
        sourceSets.main.runtimeClasspath.sort().each { println it }
    }
}

